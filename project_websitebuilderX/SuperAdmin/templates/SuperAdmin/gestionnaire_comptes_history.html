{% extends "SuperAdmin/dashbordSuperAdmin.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h3 class="fw-bold text-primary mb-3">
    <i class="mdi mdi-history"></i> Historique du gestionnaire : {{ gestionnaire.user.username }}
  </h3>

  <div class="mb-4">
    <span class="badge bg-info me-2">Total actions : {{ actions|length }}</span>
    {% if actions %}
      <span class="badge bg-success me-2">Derni√®re : {{ actions.0.date|date:"d/m/Y H:i" }}</span>
    {% endif %}
    <span class="badge bg-secondary">Utilisateur : {{ gestionnaire.user.username }}</span>
  </div>

  <!-- üîç Formulaire de filtre -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-md-4">
      <label class="form-label">Type d'objet</label>
      <select name="model_name" class="form-select">
        <option value="">Tous</option>
        {% for value, label in model_choices %}
          <option value="{{ value }}" {% if value == selected_model %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label">Date d√©but</label>
      <input type="date" name="date_start" value="{{ date_start }}" class="form-control">
    </div>

    <div class="col-md-3">
      <label class="form-label">Date fin</label>
      <input type="date" name="date_end" value="{{ date_end }}" class="form-control">
    </div>

    <div class="col-md-2 d-flex align-items-end justify-content-end">
      <button type="submit" class="btn btn-primary me-2">Filtrer</button>
      <a href="{% url 'gestionnaire_comptes_history' gestionnaire.id %}" class="btn btn-secondary">R√©initialiser</a>
    </div>
  </form>
<!-- üì§ Bouton d'export PDF -->
    <div class="mb-3 text-end">
    <a href="{% url 'gestionnaire_history_pdf' gestionnaire.id %}" class="btn btn-outline-danger" target="_blank">
        <i class="mdi mdi-file-pdf-box"></i> T√©l√©charger en PDF
    </a>
    </div>

  <!-- üìã Tableau des actions -->
  <div class="card shadow-sm">
    <div class="card-body">
      {% if actions %}
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Action</th>
              <th>Objet</th>
              <th>D√©tails</th>
            </tr>
          </thead>
          <tbody>
            {% for action in actions %}
            <tr>
              <td>{{ action.date|date:"d/m/Y H:i" }}</td>
              <td>{{ action.action }}</td>
              <td>{{ action.objet }}</td>
              <td>{{ action.details }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted text-center">Aucune action enregistr√©e pour ce gestionnaire.</p>
      {% endif %}
    </div>
  </div>

  <div class="mt-3">
    <a href="{% url 'GestionnaireComptesSuperAdmin' %}" class="btn btn-secondary">
      <i class="mdi mdi-arrow-left"></i> Retour √† la liste
    </a>
  </div>
</div>
{% endblock %}
