{% extends "SuperAdmin/dashbordSuperAdmin.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-xl-10 col-lg-11">

            <div class="d-flex justify-content-between align-items-center mb-5">
                <h2 class="fw-bold text-dark mb-0 d-flex align-items-center">
                    <i class="bi bi-pencil-square me-2 text-primary fs-3"></i> Modifier le Site Web
                </h2>
                <a href="{% url 'websites_list_superadmin' %}" class="btn btn-outline-secondary btn-lg rounded-pill shadow-sm">
                    <i class="bi bi-arrow-left"></i> Retour Ã  la Liste
                </a>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <div class="card shadow-lg border-0 rounded-4">
                            <div class="card-body p-4">

                                <h4 class="fw-bold text-primary mb-4 border-bottom pb-2">ðŸ“‹ Informations GÃ©nÃ©rales</h4>
                                <div class="row g-4 mb-4">
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.name.label }}</label>
                                        {{ form.name|add_class:"form-control"|attr:"id:id_name" }}
                                        {% if form.name.errors %}<div class="invalid-feedback d-block">{% for error in form.name.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.status.label }}</label>
                                        {{ form.status|add_class:"form-select"|attr:"id:id_status" }}
                                        {% if form.status.errors %}<div class="invalid-feedback d-block">{% for error in form.status.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.CMS.label }}</label>
                                        {{ form.CMS|add_class:"form-control"|attr:"id:id_cms" }}
                                        {% if form.CMS.errors %}<div class="invalid-feedback d-block">{% for error in form.CMS.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.catÃ©gorie.label }}</label>
                                        {{ form.catÃ©gorie|add_class:"form-select"|attr:"id:id_categorie" }}
                                        {% if form.catÃ©gorie.errors %}<div class="invalid-feedback d-block">{% for error in form.catÃ©gorie.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.langues.label }}</label>
                                        {{ form.langues|add_class:"form-control"|attr:"id:id_langues" }}
                                        {% if form.langues.errors %}<div class="invalid-feedback d-block">{% for error in form.langues.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.plan.label }}</label>
                                        {{ form.plan|add_class:"form-select"|attr:"id:id_plan" }}
                                        {% if form.plan.errors %}<div class="invalid-feedback d-block">{% for error in form.plan.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-12">
                                        <label class="form-label fw-semibold">{{ form.url.label }}</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-link"></i></span>
                                            {{ form.url|add_class:"form-control"|attr:"id:id_url" }}
                                        </div>
                                        <div class="form-text text-muted">Ex: `https://votre-site.com`</div>
                                        {% if form.url.errors %}<div class="invalid-feedback d-block">{% for error in form.url.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-12">
                                        <label class="form-label fw-semibold">{{ form.description.label }}</label>
                                        {{ form.description|add_class:"form-control"|attr:"rows:4"|attr:"id:id_description" }}
                                        {% if form.description.errors %}<div class="invalid-feedback d-block">{% for error in form.description.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                </div>

                                <h4 class="fw-bold text-primary mb-4 border-bottom pb-2">ðŸ’° DÃ©tails Financiers</h4>
                                <div class="row g-4 mb-4">
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">{{ form.prix.label }}</label>
                                        <div class="input-group">
                                            <span class="input-group-text">MAD</span>
                                            {{ form.prix|add_class:"form-control"|attr:"id:id_prix" }}
                                        </div>
                                        {% if form.prix.errors %}<div class="invalid-feedback d-block">{% for error in form.prix.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">{{ form.prix_loyer.label }}</label>
                                        <div class="input-group">
                                            <span class="input-group-text">MAD</span>
                                            {{ form.prix_loyer|add_class:"form-control"|attr:"id:id_prix_loyer" }}
                                        </div>
                                        {% if form.prix_loyer.errors %}<div class="invalid-feedback d-block">{% for error in form.prix_loyer.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">{{ form.prix_hebergement.label }}</label>
                                        <div class="input-group">
                                            <span class="input-group-text">MAD</span>
                                            {{ form.prix_hebergement|add_class:"form-control"|attr:"id:id_prix_hebergement" }}
                                        </div>
                                        {% if form.prix_hebergement.errors %}<div class="invalid-feedback d-block">{% for error in form.prix_hebergement.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                </div>

                                <h4 class="fw-bold text-primary mb-4 border-bottom pb-2">ðŸŽ¬ MÃ©dias</h4>
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.image.label }}</label>
                                        {% if website.image %}
                                        <div class="current-image-preview mb-2 d-flex align-items-center">
                                            <img src="{{ website.image.url }}" alt="Image actuelle" class="img-thumbnail me-3" style="max-height: 80px;">
                                            <a href="{{ website.image.url }}" target="_blank" class="small text-muted">Voir l'image actuelle</a>
                                        </div>
                                        {% endif %}
                                        {{ form.image|add_class:"form-control"|attr:"id:id_image" }}
                                        {% if form.image.errors %}<div class="invalid-feedback d-block">{% for error in form.image.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">{{ form.video.label }}</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-play-btn"></i></span>
                                            {{ form.video|add_class:"form-control"|attr:"id:id_video" }}
                                        </div>
                                        {% if form.video.errors %}<div class="invalid-feedback d-block">{% for error in form.video.errors %}{{ error }}{% endfor %}</div>{% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="card-footer bg-light d-flex justify-content-end gap-3 p-3">
                                <a href="{% url 'websites_list_superadmin' %}" class="btn btn-outline-secondary btn-lg rounded-pill shadow-sm">
                                    <i class="bi bi-x-circle"></i> Annuler
                                </a>
                                <button type="submit" class="btn btn-primary btn-lg rounded-pill shadow-sm">
                                    <i class="bi bi-floppy"></i> Enregistrer
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow-lg border-0 rounded-4 h-100 preview-card">
                        <div class="card-body p-4">
                            <h4 class="fw-bold text-primary mb-3">ðŸ‘€ AperÃ§u du Site</h4>
                            <div class="bg-light rounded-4 p-3 mb-4 shadow-sm">
                                <div class="position-relative text-center">
                                    <img id="preview-image" src="{% if website.image %}{{ website.image.url }}{% else %}{% static 'img/website_placeholder.jpg' %}{% endif %}" class="img-fluid rounded-4 mb-3 shadow-sm" alt="AperÃ§u du site">
                                    {% comment %} <span id="preview-status" class="badge position-absolute top-0 end-0 m-2 px-3 py-2 rounded-pill {% if website.status == 'Active' %}bg-success{% else %}bg-danger{% endif %}">
                                        {{ website.status }}
                                    </span> {% endcomment %}
                                </div>
                                <h5 class="fw-bold text-dark mt-3 mb-2" id="preview-name">{{ website.name|default:"Nom du Site" }}</h5>
                                <ul class="list-unstyled small mt-3 text-muted">
                                    <li class="d-flex align-items-center gap-2 mb-1"><i class="bi bi-tag-fill text-primary"></i> <span class="fw-semibold text-dark" id="preview-category">{{ website.catÃ©gorie|default:"CatÃ©gorie" }}</span></li>
                                    <li class="d-flex align-items-center gap-2 mb-1"><i class="bi bi-journal-check text-primary"></i> <span class="fw-semibold text-dark" id="preview-plan">{{ website.plan|default:"Plan" }}</span></li>
                                    <li class="d-flex align-items-center gap-2 mb-1"><i class="bi bi-cash-coin text-primary"></i> <span class="fw-semibold text-dark" id="preview-price">{{ website.prix|default:"0" }} MAD</span></li>
                                    <li class="d-flex align-items-center gap-2"><i class="bi bi-calendar-fill text-primary"></i> <span class="fw-semibold text-dark">{{ website.date_created|date:"d M Y" }}</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Elements to update
        const previewImage = document.getElementById('preview-image');
        const previewName = document.getElementById('preview-name');
        const previewStatus = document.getElementById('preview-status');
        const previewCategory = document.getElementById('preview-category');
        const previewPlan = document.getElementById('preview-plan');
        const previewPrice = document.getElementById('preview-price');

        // Form inputs
        const inputImage = document.getElementById('id_image');
        const inputName = document.getElementById('id_name');
        const inputStatus = document.getElementById('id_status');
        const inputCategory = document.getElementById('id_categorie');
        const inputPlan = document.getElementById('id_plan');
        const inputPrice = document.getElementById('id_prix');

        // Image preview
        if (inputImage) {
            inputImage.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                    }
                    reader.readAsDataURL(file);
                }
            });
        }

        // Name preview
        if (inputName) {
            inputName.addEventListener('input', function() {
                previewName.textContent = inputName.value || "Nom du Site";
            });
        }

        // Status preview
        if (inputStatus) {
            inputStatus.addEventListener('change', function() {
                const selectedStatus = inputStatus.options[inputStatus.selectedIndex].text;
                previewStatus.textContent = selectedStatus;
                if (selectedStatus === 'Active') {
                    previewStatus.classList.remove('bg-danger');
                    previewStatus.classList.add('bg-success');
                } else {
                    previewStatus.classList.remove('bg-success');
                    previewStatus.classList.add('bg-danger');
                }
            });
        }

        // Category preview
        if (inputCategory) {
            inputCategory.addEventListener('change', function() {
                previewCategory.textContent = inputCategory.options[inputCategory.selectedIndex].text || "CatÃ©gorie";
            });
        }

        // Plan preview
        if (inputPlan) {
            inputPlan.addEventListener('change', function() {
                previewPlan.textContent = inputPlan.options[inputPlan.selectedIndex].text || "Plan";
            });
        }

        // Price preview
        if (inputPrice) {
            inputPrice.addEventListener('input', function() {
                previewPrice.textContent = (inputPrice.value || '0') + " MAD";
            });
        }
    });
</script>

<style>
    /* General Body and Container Styles */
body {
    background-color: #f8f9fa; /* Light grey background */
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}

.container {
    max-width: 1200px;
}

/* Main Form and Card Styling */
.card {
    border: none;
    border-radius: 1.5rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08); /* Soft shadow */
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-5px); /* Lift card on hover */
    box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.12); /* Enhanced shadow on hover */
}

.card-header, .card-footer {
    border-color: rgba(0, 0, 0, 0.05);
}

/* Headings and Icons */
h2, h4 {
    font-weight: 700 !important;
    color: #0d6efd !important; /* Primary blue color */
}

h2 i, h4 i {
    color: #6c757d; /* Muted icon color */
}

h4 {
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #0d6efd;
    margin-bottom: 1.5rem;
}

/* Form Elements */
.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.5rem;
}

.form-control, .form-select {
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    border: 1px solid #ced4da;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.input-group-text {
    border-radius: 0.75rem 0 0 0.75rem;
    background-color: #e9ecef;
    border-color: #ced4da;
}

/* Buttons */
.btn {
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 50rem;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.btn-primary:hover {
    background-color: #0a58ca;
    border-color: #0a53be;
    transform: translateY(-2px);
}

.btn-outline-secondary {
    color: #6c757d;
    border-color: #6c757d;
}

.btn-outline-secondary:hover {
    color: #fff;
    background-color: #6c757d;
}

/* Image Preview */
.preview-card .rounded-4 {
    border-radius: 1rem !important;
}

.preview-card .badge {
    padding: 0.5em 1em;
    font-size: 0.85em;
    font-weight: 700;
}

.preview-card .img-fluid {
    height: 200px;
    object-fit: cover;
    width: 100%;
}

.preview-card ul li i {
    color: #0d6efd;
}
</style>
{% endblock %}