{% extends "clients/dashboard2.html" %}
{% load static %}

{% block content %}
        
        <!-- Start::app-content -->
        <div class="main-content app-content">
            <div class="container-fluid">

                <!-- PAGE-HEADER -->
                <div class="page-header">
                  <h1 class="page-title my-auto">Détails du support</h1>
                  <div>
                    <ol class="breadcrumb mb-0">
                      <li class="breadcrumb-item">
                        <a href="{% url "client:list_services" %}">Liste de support</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">Détails du support</li>
                    </ol>
                  </div>
                </div>
                <!-- PAGE-HEADER END -->



                <!-- Start::row-1 -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="row ">
                                    <div class="col-xxl-4 col-xl-12">
                                        <div class="row">
                                            <div class="col-xxl-12 col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-md-5 mb-3">
                                                <div class="product-details-wrapper">
                                                  <!-- Swiper Preview -->
                                                  <div class="swiper swiper-preview-details bd-gray-100 product-details-page">
                                                    <div class="swiper-wrapper">
                                                      {% for i in "1234" %}
                                                        <div class="swiper-slide">
                                                          <img class="img-fluid" src="{% static 'img/websitebuilder-removebg-preview.png' %}" alt="img">
                                                        </div>
                                                      {% endfor %}
                                                    </div>
                                                    <div class="swiper-button-next"></div>
                                                    <div class="swiper-button-prev"></div>
                                                  </div>
                                              
                                                  <!-- Swiper Thumbnails -->
                                                  <div class="swiper swiper-view-details mt-2">
                                                    <div class="swiper-wrapper">
                                                      {% for i in "1234" %}
                                                        <div class="swiper-slide">
                                                          <img class="img-fluid" src="{% static 'img/websitebuilder-removebg-preview.png' %}" alt="img">
                                                        </div>
                                                      {% endfor %}
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>

                                              <div class="col-xxl-12 col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-md-5 mb-3">
                                              {% with most_purchased_supports|slice:":2" as top_supports %}
                                                <div class="card custom-card bg-transparent shadow-none border rounded">
                                                      <div class="card-header flex-between justify-content-between">
                                                          <div class="card-title">Produits similaires</div>
                                                      </div>
                                                      <div class="card-body">
                                                          <div class="d-flex justify-content-evenly mt-4">
                                                            {% for item in top_supports %}
                                                              <div class="">
                                                                  <div class="text-center">
                                                                      <div class="avatar avatar-xxl bg-light p-1">
                                                                      <a href="{% url 'client:detail_support' item.id %}"><img src="{% static 'img/websitebuilder-removebg-preview.png' %}" alt="{{ item.name }}" class="img-fluid rounded"></a>
                                                                  </div>
                                                                      <h5 class="mb-1 fs-12 fw-semibold   mt-1">{{ item.name }}</h5>
                                                                      <p class="mb-0 text-muted fs-12 px-3">{{ item.description|truncatechars:50 }}</p>
                                                                      <div class="flex-fill mb-1">
                                                                          <span class="badge bg-success rounded-1">4.4<i class="ri-star-s-fill ms-1"></i></span>
                                                                          {% comment %} <span class="text-muted ms-1">(256)</span> {% endcomment %}
                                                                      </div>
                                                                      <div class="d-flex  justify-content-center mb-1">
                                                                          <h6 class="mb-0 fw-semibold">
                                                                              {{ item.prix }} MAD
                                                                          </h6>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                            {% endfor %}
                                                          </div>
      
                                                      </div>
                                                  </div>
                                                  </div>
                                              </div>
                                              {% endwith %}
                                          </div>
                                    <div class="col-xxl-8 col-xl-12 ">
                                        <div class="row product-scroll  rounded-3 border p-3">
                                            <div class="col-xl-8 mt-xxl-0 mt-3">
                                                <div>
                                                    <p class="fs-18 fw-semibold mb-0">{{ support.name }}</p>
                                                    <p class="fs-18 mb-4">
                                                        <i class="ri-star-s-fill text-warning align-middle"></i>
                                                        <i class="ri-star-s-fill text-warning align-middle"></i>
                                                        <i class="ri-star-s-fill text-warning align-middle"></i>
                                                        <i class="ri-star-s-fill text-warning align-middle"></i>
                                                        <i class="ri-star-half-s-fill text-warning align-middle"></i>
                                                        {% comment %} <span class="fw-semibold text-muted ms-1">4.3<a class="text-info" href="javascript:void(0);">(2.4k Reviews)</a></span> {% endcomment %}
                                                    </p>
                                                    <div class="row mb-4">
                                                        <div class="col-xxl-3 col-xl-12">
                                                            <p class="mb-1 lh-1 fs-11 text-success fw-semibold">Offre spéciale</p>
                                                            <div class="d-flex">
                                                                <h3 class="mb-1 fw-semibold"><span>{{ support.prix }} MAD <span class="text-muted text-decoration-line-through ms-1  fs-16 op-6">{{ support.prix|add:"100" }} MAD</span></span></h3>
                                                            </div>
                                                            <span class="rounded-1 fs-11 badge bg-danger-transparent">50% Off</span>
                                                        </div>
                                                    </div>
                                                    <div class="mb-4">
                                                      <a href="#" 
                                                        class="btn btn-warning me-2 mb-2" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#confirmationModal"
                                                        data-id="{{ support.id }}"
                                                        data-name="{{ support.name }}"
                                                        data-price="{{ support.prix }}">
                                                        Obtenir de service
                                                      </a>
                                                  </div>                          
                                                    <div class="mb-4">
                                                        <p class="fs-15 fw-semibold mb-1"><i class="ti ti-discount-2 fs-17 me-1 text-success"></i>Informations:</p>
                                                        <p class="text-muted mb-0 ps-2 mt-2">
                                                            <i class="ti ti-discount-2 fs-14 text-success d-inline-flex"></i>
                                                            <span>
                                                              {{ support.name }}
                                                            </span>
                                                         </p>
                                                         <p class="text-muted mb-0 ps-2 mt-2">
                                                            <i class="ti ti-discount-2 fs-14 text-success d-inline-flex"></i>
                                                            <span>
                                                              {{ support.status }}
                                                            </span>
                                                        </p>
                                                        <p class="text-muted mb-0 ps-2 mt-2">
                                                            <i class="ti ti-discount-2 fs-14 text-success d-inline-flex"></i>
                                                            <span>
                                                              {{ support.date_created|date:"d/m/Y" }}
                                                            </span>
                                                        </p>
                                                        <p class="text-muted mb-0 ps-2 mt-2">
                                                            <i class="ti ti-discount-2 fs-14 text-success d-inline-flex"></i>
                                                            <span>
                                                              {{ support.prix }} MAD
                                                            </span>
                                                        </p>

                                                    </div>
                                                    <div class="mb-4">
                                                        <p class="fs-15 fw-semibold mb-1">Description :</p>
                                                        <p class="text-muted mb-0">
                                                          {{ support.description }}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
                                              <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                  <form method="post" action="{% url 'client:confirm_Achat_support' %}">
                                                    {% csrf_token %}
                                                    <div class="modal-header">
                                                      <h5 class="modal-title" id="confirmationModalLabel">Confirmer l'achat du service</h5>
                                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <p id="confirmationModalText">Chargement...</p>
                                                      <input type="hidden" name="support_id" id="supportIdInput">
                                                    </div>
                                                    <div class="modal-footer">
                                                      <button type="submit" class="btn btn-primary">Confirmer</button>
                                                    </div>
                                                  </form>
                                                </div>
                                              </div>
                                            </div>
                                            <script>
                                              const confirmationModal = document.getElementById('confirmationModal');
                                              confirmationModal.addEventListener('show.bs.modal', function (event) {
                                                const button = event.relatedTarget;
                                                const supportId = button.getAttribute('data-id');
                                                const supportName = button.getAttribute('data-name');
                                                const supportPrice = button.getAttribute('data-price');
                                            
                                                // Inject content
                                                confirmationModal.querySelector('#confirmationModalText').textContent = 
                                                  `Veuillez confirmer l'achat du service "${supportName}" pour ${supportPrice} MAD.`;
                                                confirmationModal.querySelector('#supportIdInput').value = supportId;
                                              });
                                            </script>
                                               
                                            {% comment %}<div class="col-xl-4 mt-xxl-0 mt-3">

                                             <div class="border p-3 rounded-3 mb-3">
                                                <p class="fs-16 fw-semibold mb-2">Louer un site web :</p>
                                                <div class="row">
                                                    <div class="col-xl-12">
                                                        <div class="row">
                                                            {% if website.prix_loyer %}
                                                            <div class="col-xl-5">
                                                               <span class="fs-14 fw-semibold">Prix ​​Loyer</span>
                                                            </div>
                                                            <div class="col-xl-7">
                                                                <p class="text-muted fs-14">{{ website.prix_loyer }} MAD</p>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                        <div class="row">
                                                            {% if website.prix_hebergement %}
                                                            <div class="col-xl-5">
                                                               <span class="fs-14 fw-semibold">Prix Hébergementr</span>
                                                            </div>
                                                            <div class="col-xl-7">
                                                                <p class="text-muted fs-14"> {{ website.prix_hebergement }} MAD</p>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="border rounded-3 p-3">
                                                {% if website.video %}
                                                <p class="fs-15 fw-semibold mb-2">Vidéo de Présentation:</p>
                                                <p class="fs-12 text-muted"><iframe src="{{ website.video }}" title="Vidéo de présentation du site web" allowfullscreen class="rounded-3 shadow-sm"></iframe></p>
                                                {% endif %}
                                            </div> {% endcomment %}

                                            
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="col-xl-12">
                          <div class="card custom-card">
                            <div class="card-header">
                              <div class="card-title">La plupart des services</div>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                {% for item in most_purchased_supports %}
                                <div class="col-xl-2 col-6 my-2">
                                  <div class="text-center">
                                    <div class="similar-products-image me-2">
                                      <a href="{% url 'client:detail_support' item.id %}">
                                        <img src="{% static 'img/websitebuilder-removebg-preview.png' %}" alt="{{ item.name }}" class="img-fluid rounded">
                                      </a>
                                    </div>
                                    <h5 class="my-2 fs-14 fw-semibold">{{ item.name }}</h5>
                                    <div class="d-flex align-items-center justify-content-center mb-2">
                                      <h5 class="mb-0 fw-semibold">{{ item.prix }} MAD</h5>
                                      <p class="mb-0 text-muted">
                                        <span class="text-success fs-11 ms-1">Service populaire</span>
                                      </p>
                                    </div>
                                    <div class="flex-fill">
                                      <span class="badge bg-success rounded-1">4.5<i class="ri-star-s-fill ms-1"></i></span>
                                    </div>
                                  </div>
                                </div>
                                {% endfor %}
                              </div>
                            </div>
                          </div>
                        </div>
                        
                    </div>
                </div>
                <!--End::row-1 -->
              
            </div>
        </div>
        <!-- End::app-content -->


    {% endblock %}